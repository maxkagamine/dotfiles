#!/bin/bash
#
# Copyright (c) Max Kagamine
# Licensed under the Apache License, Version 2.0
#
set -eo pipefail

# shellcheck source=mods/bash/.local/lib/common.sh
. ~/.local/lib/common.sh

help() {
  cat >&2 <<'EOF'
Usage: ass-ls-fonts [<subs>]

Lists all unique fonts referenced in the subs via either `Style:` or `\fn`.

Directories are expanded to contained *.ass files (non-recursive). If no paths
are given, the current directory is used.
EOF
  exit 1
}

parse_args \
  -h,--help \
  -- "$@"

expand_directories \
  --glob '*.ass' --var paths --default . --required -- "${REST[@]}"

perl -ne '
  /^Style:.*?,([^,]+)/ && print "$1\n";
  print "$1\n" while /\\fn([^\\\}]+)/g;
' "${paths[@]}" | sort -u
