#!/bin/bash
set -eo pipefail
shopt -s nullglob

throw() {
  printf '%s: %s\n' "${0##*/}" "$1" >&2
  return 1
}

if [[ $1 =~ ^(--help|-h)$ ]]; then
  cat >&2 <<'EOF'
Usage: ass-ls-fonts [<subs>]

Lists all unique fonts referenced in the subs via either `Style:` or `\fn`.

<subs> defaults to `*.ass`.
EOF
  exit 1
fi

subs=("$@")
if (( $# == 0 )); then
  subs=(*.ass)
fi
if (( ${#subs[@]} == 0 )); then
  throw 'no files to process'
fi

perl -ne '
  /^Style:.*?,([^,]+)/ && print "$1\n";
  print "$1\n" while /\\fn([^\\\}]+)/g;
' "${subs[@]}" | sort -u
