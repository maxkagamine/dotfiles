#!/bin/bash
#
# Copyright (c) Max Kagamine
# Licensed under the Apache License, Version 2.0
#
set -eo pipefail

# shellcheck source=mods/bash/.local/lib/common.sh
. ~/.local/lib/common.sh

help() {
  cat >&2 <<'EOF'
Usage: mkv-rm-cover <path...>

Removes all image/jpeg and image/png attachments from the given MKVs.

Directories are expanded to contained *.mkv files (non-recursive). If no paths
are given, the current directory is used.

See also: mkv-clean
EOF
  exit 1
}

parse_args \
  -h,--help \
  -- "$@"

expand_directories \
  --glob '*.mkv' --var paths --default . --required -- "${REST[@]}"

for f in "${paths[@]}"; do

  mkvpropedit "$f" \
    --delete-attachment mime-type:image/jpeg \
    --delete-attachment mime-type:image/png |
    grep -v 'Warning: No attachment matched the spec' || true

done
